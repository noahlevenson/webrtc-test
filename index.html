<!DOCTYPE html>
<html>

<head>

</head>

<body>
Hello bitch, paste your shit below:

<br>

<textarea id="peer-offer" style="width: 500px; height: 300px;"></textarea>

<br>

<button type="button" id="accept-offer-button">accept offer</button>
<button type="button" id="accept-answer-button">accept answer</button>
<button type="button" id="new-ice-candidate-button">add ice candidate</button>


<script>
const offerTextArea = document.getElementById("peer-offer");
const acceptOfferButton = document.getElementById("accept-offer-button");
const acceptAnswerButton = document.getElementById("accept-answer-button");
const newIceCandidateButton = document.getElementById("new-ice-candidate-button");

const rtcConfig = {
	iceServers: [
		{
			urls: "stun:stun.l.google.com:19302"
		}
	]
};

const localConnection = new RTCPeerConnection(rtcConfig);
const dataChannel = localConnection.createDataChannel("myDataChannel");

localConnection.createOffer().then((offer) => {
	localConnection.setLocalDescription(offer);

	console.log(`My offer is:`);
	console.log(JSON.stringify(offer));
});

// icecandidate fires when the connection sets its local description
// the event object contains the ICE candidate which must be signalled to the remote peer
localConnection.onicecandidate = (e) => {
	console.log(`Announcing my local ice candidate (null denotes end of candidates):`);
	console.log(JSON.stringify(e.candidate));
};

acceptOfferButton.onclick = (e) => {
	localConnection.setRemoteDescription(JSON.parse(offerTextArea.value)).then(() => {
		return localConnection.createAnswer();
	}).then((answer) => {
		console.log(`My answer is:`);
		console.log(JSON.stringify(answer));

		offerTextArea.value = null;
	});
};

acceptAnswerButton.onclick = (e) => {
	localConnection.setRemoteDescription(JSON.parse(offerTextArea.value)).then(() => {
		offerTextArea.value = null;
	});
};

newIceCandidateButton.onclick = (e) => {
	localConnection.addIceCandidate(JSON.parse(offerTextArea.value)).catch((err) => {
		// Handle this error
	});

	offerTextArea.value = null;
};

localConnection.ondatachannel = (e) => {
	console.log("data channel achieved, bitch");
};

</script>

</body>
</html>
